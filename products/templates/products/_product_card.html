{% load static %}
<div class="col-6 col-md-4 col-lg-3">
    <div class="card product-card border-0 shadow-sm h-100">
        <!-- Image slideshow -->
        <div class="position-relative">
            {% if product.discount_percent %}
            <span class="badge bg-danger position-absolute top-0 start-0 m-2 z-1">-{{ product.discount_percent }}%</span>
            {% endif %}

            {% if product.images.all|length > 1 %}
            <div class="swiper product-swiper-{{ product.pk }}">
                <div class="swiper-wrapper">
                    {% for img in product.images.all %}
                    <div class="swiper-slide">
                        <a href="{{ product.get_absolute_url }}">
                            <img src="{{ img.image.url }}" class="card-img-top product-card-img" alt="{{ product.name }}">
                        </a>
                    </div>
                    {% endfor %}
                </div>
                <div class="swiper-pagination"></div>
            </div>
            {% elif product.primary_image %}
            <a href="{{ product.get_absolute_url }}">
                <img src="{{ product.primary_image.image.url }}" class="card-img-top product-card-img" alt="{{ product.name }}">
            </a>
            {% else %}
            <a href="{{ product.get_absolute_url }}">
                <div class="card-img-top product-card-img bg-light d-flex align-items-center justify-content-center">
                    <i class="bi bi-image fs-1 text-muted"></i>
                </div>
            </a>
            {% endif %}

            <!-- Favorite button -->
            {% if user.is_authenticated %}
            <button class="btn btn-light btn-sm position-absolute top-0 end-0 m-2 rounded-circle fav-btn z-1"
                    data-product-id="{{ product.pk }}"
                    onclick="toggleFavorite({{ product.pk }}, this)">
                <i class="bi bi-heart{% if product.pk in favorite_ids %}-fill text-danger{% endif %}"></i>
            </button>
            {% endif %}
        </div>

        <div class="card-body d-flex flex-column">
            <small class="text-muted mb-1">{{ product.category.name }}</small>
            <h6 class="card-title mb-2">
                <a href="{{ product.get_absolute_url }}" class="text-decoration-none text-dark product-link">{{ product.name }}</a>
            </h6>
            {% if product.material %}
            <small class="text-muted"><i class="bi bi-layers me-1"></i>{{ product.get_material_display }}</small>
            {% endif %}
            <div class="mt-auto pt-2">
                <div class="d-flex align-items-center mb-2">
                    <span class="fw-bold fs-5 text-dark">${{ product.price }}</span>
                    {% if product.old_price %}
                    <span class="text-decoration-line-through text-muted ms-2 small">${{ product.old_price }}</span>
                    {% endif %}
                </div>
                <button class="btn btn-dark btn-sm w-100 add-to-cart-btn"
                        onclick="addToCart({{ product.pk }})"
                        {% if not product.in_stock %}disabled{% endif %}>
                    {% if product.in_stock %}
                    <i class="bi bi-cart-plus me-1"></i> Add to Cart
                    {% else %}
                    Out of Stock
                    {% endif %}
                </button>
            </div>
        </div>
    </div>
</div>
